### 1 同源策略
同源策略是 **浏览器** 的一种安全保护机制，用于限制一个源（origin）的文档或脚本如何与另一个源的资源进行交互。
同源要求交互双方的协议、主机和端口号都需要相同。
![[同源策略.png|600]]
对于非同源的双方，浏览器做了如下的限制：
- **文档内容访问**：不同源的页面之间无法直接访问对方的 DOM（文档对象模型）。例如，一个网站的页面不能通过 JavaScript 读取另一个不同源网站页面中的文本框内容、按钮状态等信息。
- **数据交互**：限制通过 AJAX 等技术进行跨源数据请求。比如，在一个网页中使用 AJAX 向不同源的服务器请求数据，默认情况下会被浏览器阻止，以防止敏感数据被非法获取。
- **资源加载**：虽然可以从不同源加载一些资源，如图片、样式表、脚本等，但存在一定限制。例如，加载的脚本不能访问非同源页面的敏感信息，样式表不能影响非同源页面的布局等。
### 2 跨域方案
#### 2.1 JSONP 方案
##### 原理
跨域问题存在在通过 AJAX 和 Fetch 发送请求的过程中，但是在 `<script>` 标签中又可以请求别的源的数据，比如：
```html
<script>
	<link href="https://fonts.googleapis.com/css?family=El+Messiri" rel="stylesheet" />
</script>
```
这是因为 `script` 在设计之初，就允许在别的源请求脚本；开发者通过这个漏洞来完成跨域，这种方式就叫做 JSONP。
##### 方案
```html
<script>
	function bb ( data ) {
		console.log( data )
	}
</script>
<script src="http://localhost:8080/server/index.php" type="text/javascript" />
```
```php
<?php 
	echo " 'bb('hello world')";
?>
```
请求本地 server 来加载 script 脚本，而加载脚本是不存在跨域问题的，server 端传输的是一个函数调用，此时就完成了数据的传送。

丰富一下上面的方案，可以将传输的数据类型规定为 JSON 格式，给 server 的请求中携带上处理用的函数，将这些数据作为请求参数传递到服务端，服务端根据参数返回对应的封装好的 script 脚本，这样就完成了一次请求。

这个方案由于是将数据作为 script 脚本请求的，所以其只支持 GET 请求和连接传值。
#### 2.2 CORS 方案
##### 原理
![[CORS 方案.png|800]]
浏览器发送请求的时候会携带自己的协议、主机和端口信息，然后服务器会在请求头中携带一个 `Access-Control-Allow-Origin` 字段，浏览器根据这个字段来决定是否可以进行跨域。
##### 对修改的预检
如果有人恶意的调用 DELETE 或者 PUT 这样的修改方法，浏览器会先发送一个 method:OPTION 的预检请求，来检测服务端是否允许这个方法的跨域访问，发现允许后才会允许请求。
![[预检请求.png|800]]